\chapter{はじめに}

仮想化技術とは物理マシンをソフトウェアによってエミュレートし，仮想化されたリソースを用いて
自身の OS やアプリケーションを物理マシンから独立した環境で仮想マシン (VM) として動作させる
技術である．仮想マシンモニタ (VMM) というソフトウェアによって VM の作成，管理が行われる．
VM は単一の物理マシン上で複数構築することが可能であるため主にコンソリデーションに用いられ，
複数のサーバを統合することでサーバの管理コストを削減することができる．
実際に，Google Cloud Platform \cite{CloudComputingServices}や Amazon Web Services \cite{CloudComputingServicesa}，
Microsoft Azure \cite{CloudComputingServicesb}など Real-world なクラウド環境で使用されている．

仮想マシンライブ移送は，VM を稼働しながらその実行の影響を最小限に抑えつつ
別ホストに移送する技術である．
サーバー統合，ゼロダウンタイムでのハードウェアメンテナンス，エネルギー管理，トラフィック管理など，
クラウド管理業務の大部分は VM ライブ移送によって支えられている\cite{zhangSurveyVirtualMachine2018}．
例えば，Google のデータセンタ\cite{HomepageNdashGoogle}においても，
大規模なクラスタ管理やメンテナンスのためにライブ移送技術が日常的に利用されている．
移送手法には，先に移送先ホストにメモリを転送してから VM の実行権を移す Pre-copy 手法\cite{clarkLiveMigrationVirtual}と，
先に VM の実行権を移送先ホストに移してからメモリを転送する Post-copy 手法\cite{hinesPostcopyLiveMigration2009}がある．
Pre-copy 手法は耐障害性が優れているが，反復的なメモリ転送によって総移送時間が長期化する傾向がある．
Post-copy 手法は短時間での移送が可能だが，移送中に移送先ホストで障害が発生すると VM が
壊れてしまうという致命的なリスクも伴う．
このように，両手法には信頼性と即時性でトレードオフが存在するため，
移送する環境によって移送手法を変えることが望ましい．

ドキュメントデータベース (DDB) はキーと値のペアをドキュメントで管理する，
NoSQL データベースの一種である．
リアルタイム分析，ロギング，そしてブログのような小規模で柔軟な Web サイトで使用されており\cite{hechtNoSQLEvaluationUse2011}，
代表的な DDB の１つに MongoDB \cite{MongoDB}がある．
VM ライブ移送における問題に，MongoDB のような DDB などのメモリ集約型アプリケーションを
実行している VM の移送に時間が要することが挙げられる．
メモリサイズが大きい VM の移送は反復転送が長期化することで総移送時間も増加する傾向がある．
さらに，MongoDB のようなページへの書き込み頻度が高いアプリケーションは，
ダーティレートがメモリ転送速度を上回ると反復転送が収束せずダウンタイム中に転送する必要があるページ量も増加するため，
総移送時間とダウンタイムの両方が大幅に増加してしまう可能性がある．
実際にAmazon Document DB \cite{AmazonDocumentDBServerless} において，
最大 768GB ものメモリを使用可能であり，DDB を稼働させる VM のメモリサイズは肥大化している．
そのためこのような大規模なメモリを持つ VM の移送遅延は解決すべき重要な課題となっている．

本論文では，DDB と連動した仮想マシンの移送手法を提案する．
提案手法では，DDB 上のキャッシュをクリアしてそれらの転送をスキップすることで，
VM の移送時間を短縮する．
DDB が稼働している VM においても短時間の移送を実現するため，
ライブ移送による負荷分散や電力削減といった効果を得る．

本論文の貢献は以下の通りである．
\begin{itemize}
  \item DDB が稼働している VM のライブ移送時間を短縮する手法を提案した．
  DDB 上のキャッシュをクリアしてそれらの転送をスキップすることで VM の移送時間を短縮する．
  \item 提案手法の実現のために DDB 上のキャッシュをクリアする機構とホスト OS
  でクリアしたページの転送を制御する機構を設計した．
  \item 提案手法を QEMU 10.2.0，MongoDB 8.2.2 に実装し，
  キャッシュ転送量と移送時間の大幅な削減に成功した．
\end{itemize}

本論文では，第 2 章で本研究の背景となる仮想化技術や仮想マシンライブ移送，
ドキュメントデータベースについて述べ，それに関する問題についても述べる．
第 3 章では関連研究について紹介し，本研究との違いを述べる．
第 4 章で本研究の提案について述べ，そのアプローチや技術的課題を説明する．
第 5 章で提案手法の設計について述べ，第 6 章でその実装について述べる．
第 7 章では提案手法を適用して実験を行い，その結果について述べる．
第 8 章でまとめと今後の課題について述べる．
